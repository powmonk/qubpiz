<div>
  <h1>MC Control Panel</h1>
  
  <div class="quiz-actions">
    <button (click)="showQuizList = !showQuizList" class="select-btn">
      {{ showQuizList ? 'Hide Quiz List' : 'Select Quiz' }}
    </button>
    <button (click)="showNewQuizForm = !showNewQuizForm" class="create-btn">
      {{ showNewQuizForm ? 'Cancel Creation' : 'Create New Quiz' }}
    </button>
  </div>

  <div *ngIf="showQuizList" class="quiz-list">
    <h3>All Quizzes</h3>
    <div *ngIf="allQuizzes.length === 0" class="no-quizzes">
      No quizzes created yet.
    </div>
    <ul>
      <li *ngFor="let quiz of allQuizzes" (click)="selectQuiz(quiz.id)" 
          [class.active]="currentQuiz?.id === quiz.id">
        <div class="quiz-item">
          <strong>{{ quiz.quiz_name }}</strong>
          <span class="quiz-date">{{ quiz.quiz_date | date:'mediumDate' }}</span>
          <button (click)="deleteQuiz(quiz.id, $event)" class="delete-btn-small">×</button>
        </div>
      </li>
    </ul>
  </div>

  <div *ngIf="showNewQuizForm" class="quiz-form">
    <h3>Create New Quiz</h3>
    <label>Quiz Name</label>
    <input 
      type="text" 
      [(ngModel)]="newQuizName" 
      placeholder="e.g., Pub Quiz - October 21st"
    />
    
    <label>Quiz Date</label>
    <input 
      type="date" 
      [(ngModel)]="newQuizDate"
    />
    
    <button (click)="createQuiz()" class="save-btn">Create Quiz</button>
  </div>

  <div *ngIf="currentQuiz" class="current-quiz">
    <h2>{{ currentQuiz.quiz_name }}</h2>
    <p class="quiz-date-display">{{ currentQuiz.quiz_date | date:'fullDate' }}</p>
    
    <div class="game-status-panel">
      <button (click)="toggleGameStatus()" 
              [ngClass]="{
                'start-game-btn': currentQuiz.status === 'waiting' || currentQuiz.status === 'closed', 
                'end-game-btn': currentQuiz.status === 'active'
              }">
        <span *ngIf="currentQuiz.status === 'waiting'">Start Game & Open Lobby</span>
        <span *ngIf="currentQuiz.status === 'active'">Close Lobby (Game Running)</span>
        <span *ngIf="currentQuiz.status === 'closed'">Re-Open Lobby (Game Running)</span>
      </button>
      <p>Status: <strong>{{ currentQuiz.status | uppercase }}</strong></p>
    </div>
    
    <div class="player-management">
      <h3>Players in Game ({{ players.length }})</h3>
      <div *ngIf="players.length === 0" class="no-players">
        No players have joined yet.
      </div>
      <ul class="player-list">
        <li *ngFor="let player of players">
          <span>{{ player }}</span>
          <button (click)="removePlayer(player)" class="remove-player-btn">Remove</button>
        </li>
      </ul>
      <button (click)="resetGame()" class="reset-btn">Clear All Players</button>
    </div>
    <app-round-manager 
      [currentQuizId]="currentQuiz.id"
      [currentDisplayedRoundId]="currentQuiz.current_round_id"
      (roundSelected)="onRoundSelected($event)">
    </app-round-manager>
    
    <app-question-manager 
      *ngIf="selectedRound"
      [currentRound]="selectedRound">
    </app-question-manager>
  </div>
  <div class="round-manager-container">
    <h3>Rounds</h3>
    
    <div class="round-control-buttons">
      <button (click)="showNewRoundForm = !showNewRoundForm" class="add-round-btn">
        {{ showNewRoundForm ? 'Cancel' : '+ Add New Round' }}
      </button>

      <button *ngIf="currentDisplayedRoundId" (click)="setDisplayRound(null)" class="clear-display-btn">
        Clear Player Display
      </button>
    </div>
    
    <div *ngIf="showNewRoundForm" class="round-form">
        </div>
    
    <div *ngIf="rounds.length === 0" class="no-rounds">
        No rounds created yet.
    </div>

    <ul class="round-list">
        <li *ngFor="let round of rounds" 
            [class.active]="selectedRound?.id === round.id"
            [class.is-displayed]="currentDisplayedRoundId === round.id">
            
            <div class="round-item-main" (click)="selectRound(round)">
                <div class="round-info">
                    <strong>Round {{ round.round_order }}: {{ round.name }}</strong>
                    <span class="round-type">({{ round.round_type | titlecase }})</span>
                </div>
            </div>
            
            <div class="round-actions">
                <button (click)="setDisplayRound(round)" 
                        [class]="currentDisplayedRoundId === round.id ? 'display-active-btn' : 'display-btn'"
                        [disabled]="currentDisplayedRoundId === round.id">
                    {{ currentDisplayedRoundId === round.id ? 'DISPLAYING' : 'Display Round' }}
                </button>
                
                <button (click)="deleteRound(round.id, $event)" class="delete-btn-small">×</button>
            </div>
        </li>
    </ul>
</div>

  <div *ngIf="!currentQuiz && !showNewQuizForm && !showQuizList" class="no-selection">
    <p>Select an existing quiz or create a new one to get started.</p>
  </div>
</div>